SELECT TILL_RECEIPT_NUMBER, customersT.CUSTOMER_ID, CU_GENDER, CUSHOM, FSPTS, Grocery, Tobacco, Deli, DBeverages, Lottery
FROM(
SELECT TILL_RECEIPT_NUMBER, CUSTOMER_ID, 
IIF(SUM(IIF(SUB_DEPARTMENT in (7,3,6,4,5,1), sales_value, NULL))>0, 1,NULL) AS Grocery,
IIF(SUM(IIF(SUB_DEPARTMENT in (78,79), sales_value, NULL))>0, 1,NULL) AS Tobacco,
IIF(SUM(IIF(SUB_DEPARTMENT in (83,84,90,85,93,86,88,89,94,95,96,87,97,98,91,92), sales_value, NULL))>0, 1,NULL) AS Deli,
IIF(SUM(IIF(SUB_DEPARTMENT in (83), sales_value, NULL))>0, 1,NULL) AS DBeverages,
IIF(SUM(IIF(SUB_DEPARTMENT in (160,161,201), sales_value, NULL))>0, 1,NULL) AS Lottery
FROM transactionsT
GROUP BY TILL_RECEIPT_NUMBER, CUSTOMER_ID) as baskets
INNER JOIN customersT ON baskets.CUSTOMER_ID = customersT.CUSTOMER_ID;